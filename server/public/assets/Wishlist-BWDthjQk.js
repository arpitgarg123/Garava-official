import{h as A,u as R,a as n,w as $,x as F,y as O,z as q,A as z,C as B,r as S,D as C,j as e,B as D,E as L,q as l,F as H,H as E}from"./index-CKwcYcCo.js";import{W as T}from"./LoadingSkeleton--JWO6ykG.js";const G=()=>{const x=A(),r=R(),g=n($),p=n(F),f=n(O),j=n(q),d=n(z),m=n(B);S.useEffect(()=>{m&&(d==="idle"||d==="failed")&&r(C({force:!1}))},[r,m,d]),S.useEffect(()=>{if(m&&d==="succeeded"){const a=p.length,t=g.length;a>t&&a>0&&(console.log(`Wishlist page - Product count mismatch (${t} products vs ${a} IDs), fetching fresh data...`),r(C({force:!0})))}},[r,m,g.length,p.length,d]);const M=a=>{r(E(a)).unwrap().then(()=>{l.success("Removed from wishlist!")}).catch(t=>{l.error("Failed to remove from wishlist"),console.error("Remove wishlist error:",t)})},_=a=>{var u;const t=a.product;if(!t){l.error("Product information is missing");return}if(!m){l.error("Please login to add items to cart"),x("/login");return}const s=(u=t.variants)==null?void 0:u[0],i={productId:t._id||t.id,quantity:1};if(s!=null&&s._id?i.variantId=s._id:s!=null&&s.sku&&(i.variantSku=s.sku),!i.variantId&&!i.variantSku){console.error("Missing variant information:",{product:t,variant:s}),l.error("Product variant information is missing. Please try again or contact support.");return}console.log("Moving to cart:",{cartItem:i,product:t.name}),r(H(i)).unwrap().then(()=>{l.success("Added to cart!"),r(E(a.productId||t._id)).unwrap().then(()=>{x("/cart")}).catch(c=>{console.error("Remove from wishlist error:",c)})}).catch(c=>{const o=c.message||"Failed to add to cart";l.error(o),console.error("Add to cart error:",c)})};return f?e.jsx("div",{className:" min-h-[60vh] py-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-semibold mb-8",children:"My Wishlist"}),e.jsx(T,{})]})}):j?e.jsx("div",{className:" min-h-[60vh] py-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-semibold mb-8",children:"My Wishlist"}),e.jsxs("p",{className:"text-center text-red-500",children:["Error loading wishlist: ",j]})]})}):e.jsxs("div",{className:" min-h-[60vh] mt-28",children:[e.jsx("div",{className:"sticky top-35 z-10 mb-3",children:e.jsx(D,{})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-semibold mb-8",children:"My Wishlist"}),g.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[e.jsx(L,{size:60,className:"text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"Your wishlist is empty"}),e.jsx("button",{onClick:()=>x("/products/jewellery"),className:"bg-black text-white px-8 py-2 hover:bg-gray-800 transition",children:"Continue Shopping"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:g.map((a,t)=>{var y,N,b,k,w,I,W,P;const s=a.product,i=a.productId||(s==null?void 0:s._id),u=(s==null?void 0:s.slug)||i,c=((N=(y=s==null?void 0:s.variants)==null?void 0:y[0])==null?void 0:N.price)||(s==null?void 0:s.price)||0,o=!((b=s==null?void 0:s.variants)!=null&&b.some(h=>h.isActive!==!1&&(h.stock||0)>0&&h.stockStatus!=="out_of_stock")),v=((k=s==null?void 0:s.heroImage)==null?void 0:k.url)||(s==null?void 0:s.heroImage)||((I=(w=s==null?void 0:s.gallery)==null?void 0:w[0])==null?void 0:I.url)||((W=s==null?void 0:s.gallery)==null?void 0:W[0])||"https://via.placeholder.com/300x300?text=No+Image";return!((P=s==null?void 0:s.heroImage)!=null&&P.url)&&!(s!=null&&s.heroImage)&&console.log("Product missing images:",{productName:s==null?void 0:s.name,heroImage:s==null?void 0:s.heroImage,gallery:s==null?void 0:s.gallery,usingFallback:v}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"relative group cursor-pointer overflow-hidden ",onClick:()=>x(`/product_details/${u}`),children:[e.jsx("img",{src:v,alt:(s==null?void 0:s.name)||"Product",className:"w-full aspect-square object-cover hover:scale-105  transition duration-300 bg-gray-200",onError:h=>{console.log("Image failed to load:",v),h.target.src="https://via.placeholder.com/300x300?text=No+Image"}}),o&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsx("span",{className:"bg-red-600 text-white px-3 py-1 rounded-md font-medium text-sm",children:"Out of Stock"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:(s==null?void 0:s.name)||`Product ${i}`||"Unnamed Product"}),e.jsx("p",{className:"text-gray-600",children:(s==null?void 0:s.type)||"Product"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-semibold",children:["â‚¹",c.toLocaleString()]}),o&&e.jsx("span",{className:"text-red-600 text-sm font-medium",children:"Out of Stock"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx("button",{onClick:()=>_(a),disabled:f||o,className:`px-4 py-2 text-sm transition cursor-pointer ${o?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-black text-white hover:bg-gray-800"}`,children:o?"Out of Stock":"Move to Cart"}),e.jsx("button",{onClick:()=>M(i),className:"text-red-500 cursor-pointer hover:text-red-700",disabled:f,children:"Remove"})]})]},i||`wishlist-item-${t}`)})})]})]})};export{G as default};
