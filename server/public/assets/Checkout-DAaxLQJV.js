import{u as F,h as G,b as U,a as c,n as V,S as Y,C as q,T as M,U as $,V as z,W,X as B,Y as K,r as l,Z as Q,q as m,_ as I,$ as S,a0 as X,j as e,a1 as Z,a2 as D}from"./index-CKwcYcCo.js";import{f as t,C as i}from"./pricing-Cv4rcUXx.js";const se=()=>{const d=F(),o=G(),y=U(),u=c(V),x=c(Y),g=c(q);c(M);const N=c($),v=c(z),b=c(W),p=c(B),a=c(K),[j,A]=l.useState(null),[R,L]=l.useState(null),[r,w]=l.useState("phonepe"),[f,T]=l.useState(!1);c(s=>j?Q(s,j):null),l.useEffect(()=>{if(!g){o("/login");return}},[g,o]),l.useEffect(()=>{if(u.length===0){m.error("Your cart is empty"),o("/cart");return}},[u,o]),l.useEffect(()=>{p&&!f&&(T(!0),console.log("Redirecting to PhonePe payment URL:",p),window.location.href=p)},[p,f]),l.useEffect(()=>{const s=new URLSearchParams(y.search),n=s.get("orderId"),h=s.get("status");n&&h&&(h==="success"?(d(I()),m.success("Payment completed successfully!"),o(`/orders/${n}`)):h==="failed"&&(m.error("Payment failed. Please try again."),o("/cart")),d(S()))},[y.search,d,o]),l.useEffect(()=>{a&&d(S())},[r]),l.useEffect(()=>()=>{d(X())},[d]);const _=s=>{A(s)},k=s=>{L(s)},O=()=>R?!0:(m.error("Please select a shipping address"),!1),H=async()=>{if(O())try{const s={items:u.map(n=>({variantId:n.variantId,variantSku:n.variantSku,quantity:n.quantity})),addressId:j,paymentMethod:r};if(console.log("Placing order with data:",s),r==="phonepe")d(D(s));else if(r==="cod"){const n=await d(D(s)).unwrap();n.success&&(d(I()),m.success("Order placed successfully!"),o(`/orders/${n.order._id}`))}}catch(s){console.error("Order placement error:",s),m.error(s.message||"Failed to place order")}};return!g||u.length===0?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(Z,{selectedAddressId:j,onAddressSelect:_,onAddressChange:k}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Payment Method"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"phonepe",checked:r==="phonepe",onChange:s=>w(s.target.value),className:"text-black focus:ring-black"}),e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"PhonePe Payment Gateway"}),e.jsx("span",{className:"text-xs text-gray-500",children:"(Cards, UPI, Wallets)"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:r==="cod",onChange:s=>w(s.target.value),className:"text-black focus:ring-black"}),e.jsx("span",{children:"Cash on Delivery"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm h-fit",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-4 mb-6",children:u.map((s,n)=>{var h,E,P,C;return e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-gray-200 rounded-md overflow-hidden",children:(h=s.product)!=null&&h.heroImage?e.jsx("img",{src:typeof s.product.heroImage=="string"?s.product.heroImage:s.product.heroImage.url,alt:((E=s.product)==null?void 0:E.name)||"Product",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"No Image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:((P=s.product)==null?void 0:P.name)||"Product"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.variantSku&&e.jsxs("span",{className:"text-xs text-gray-500 bg-white px-2 py-1 rounded",children:["SKU: ",s.variantSku]}),((C=s.variant)==null?void 0:C.sizeLabel)&&e.jsxs("span",{className:"text-xs text-gray-500 bg-white px-2 py-1 rounded",children:["Size: ",s.variant.sizeLabel]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t((s.unitPrice||0)*s.quantity)}),s.quantity>1&&e.jsxs("div",{className:"text-xs text-gray-500",children:[t(s.unitPrice||0)," each"]})]})]})]})]},s._id||n)})}),e.jsx("div",{className:"border-t pt-4 space-y-2",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:t(a.subtotal)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Delivery"}),e.jsx("span",{children:a.shippingTotal===0?"Free":t(a.shippingTotal)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"COD Charge"}),e.jsx("span",{children:a.codCharge>0?t(a.codCharge):"—"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount"}),e.jsx("span",{children:a.discountTotal>0?`- ${t(a.discountTotal)}`:"—"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:a.taxTotal>0?t(a.taxTotal):"—"})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:t(a.grandTotal)})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:t(x)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Delivery"}),e.jsx("span",{children:x>=i.FREE_DELIVERY_THRESHOLD?"Free":t(i.DELIVERY_CHARGE)})]}),r==="cod"&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"COD Charge"}),e.jsx("span",{children:t(i.COD_HANDLING_FEE)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount"}),e.jsx("span",{children:"—"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:"—"})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:t(x+(x>=i.FREE_DELIVERY_THRESHOLD?0:i.DELIVERY_CHARGE)+(r==="cod"?i.COD_HANDLING_FEE:0))})]})]})}),b&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-red-800 text-sm",children:b})}),e.jsx("button",{onClick:H,disabled:N||v||f,className:"w-full mt-6 bg-black text-white py-3 px-6 rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:N||v||f?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r==="phonepe"?"Processing Payment...":"Placing Order..."]}):`${r==="phonepe"?"Pay":"Place Order"} ${t((a==null?void 0:a.grandTotal)??x+(x>=i.FREE_DELIVERY_THRESHOLD?0:i.DELIVERY_CHARGE)+(r==="cod"?i.COD_HANDLING_FEE:0))}`})]})]})]})})};export{se as default};
